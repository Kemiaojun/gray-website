import{d as L,j,E as U,f as q,g as P,h as W,i as H}from"./element-plus-COxNbMku.js";import{l as J,f as O,g as Q}from"./resources-CpDDbBfw.js";import{G as V}from"./GWTitleImageCard-CCoiUGbV.js";import{g as K,f as X,_ as R}from"./index-DDkzpx4-.js";import{d as z,r as c,G as Y,b as A,o as g,c as b,a as C,Q as D,S as Z,H as B,L as o,M as E,a7 as ee,P as r,T as I}from"./@vue-BV9Q_yhH.js";import"./lodash-es-BDpUAi6D.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-DVUPgnhb.js";import"./dayjs-Didlxlvp.js";import"./@element-plus-DgtNr1CL.js";import"./@ctrl-D_sRHO8g.js";import"./@popperjs-D9SI2xQl.js";import"./axios-Cm0UX6qg.js";import"./pinia-CWZPuNdE.js";import"./vue-router-DaOdIdNP.js";import"./vue-pdf-embed-BcRweBTn.js";const te=["src"],le=z({__name:"ImageUpload",props:{imageUrl:{}},emits:["selectFile"],setup(F,{emit:m}){const v=F,i=c(null),a=c(null),n=c(),t=m,y=u=>{const d=u.target;if(d.files&&d.files[0]){i.value=d.files[0];const p=new FileReader;p.onload=k=>{var f;a.value=(f=k.target)==null?void 0:f.result},p.readAsDataURL(i.value),t("selectFile",i.value)}},h=()=>{n.value.click()};return Y(()=>{i.value=null}),A(()=>{v.imageUrl&&(a.value=K()+v.imageUrl)}),(u,d)=>{const p=X;return g(),b("div",{class:"image-upload",onClick:h},[C("input",{ref_key:"fileselectRef",ref:n,style:{display:"none"},type:"file",accept:"image/*",onChange:y},null,544),C("div",{class:"image-preview",style:Z({border:a.value?"none":"1px solid var(--gw-bg-active-color)"})},[a.value?(g(),b("img",{key:0,style:{height:"200px",width:"auto","border-radius":"10px","object-fit":"contain"},src:a.value,alt:"预览图片"},null,8,te)):(g(),D(p,{key:1,size:50,"icon-class":"add"}))],4)])}}}),ae=R(le,[["__scopeId","data-v-c9591a32"]]),oe={class:"graython-Collection-root"},ne=["onClick"],se=["onClick"],ie=z({__name:"Collection",setup(F){const m=c(!0),v=c(),i=c();A(()=>{a()});const a=async()=>{await J().then(e=>{i.value=e.data})},n=c(!1),t=B({name:""});let y;const h=B({name:[{required:!0,message:"请输入合集名称",trigger:"blur"}]}),u=e=>{e?(t.id=e.id,t.name=e.name,t.thumbnailUrl=e.thumbnailUrl):(t.id=void 0,t.name="",t.thumbnailUrl=void 0)},d=()=>{u(),n.value=!0},p=e=>{u(e),n.value=!0};function k(e){j.confirm("确定要删除合集["+e.name+"]吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await O(e.id).then(()=>{a()}),U({type:"success",message:"删除成功!"})}).catch(()=>{U({type:"info",message:"取消删除"})})}const f=()=>{n.value=!1},S=async e=>{m.value&&e&&await e.validate(async(s,x)=>{if(s){m.value=!1;let _=new FormData;_.append("file",y),_.append("entity",JSON.stringify({id:t.id,name:t.name})),await Q(_).then(w=>{m.value=!0,u(),f(),a()}).finally(()=>{m.value=!0})}else console.log("error submit!",x)})},T=e=>{y=e};return(e,s)=>{const x=q,_=P,w=W,$=H,M=L;return g(),b(E,null,[C("div",oe,[o(V,{blankCard:!0,onClick:d}),(g(!0),b(E,null,ee(i.value,(l,N)=>(g(),D(V,{blankCard:!1,key:N,image:l.thumbnailUrl,title:l.name,"card-data":l},{"customize-btn":r(()=>[C("span",{onClick:G=>p(l),style:{color:"green"},class:"customize-btn iconbl bl-a-fileedit-line"},null,8,ne),C("span",{onClick:G=>k(l),style:{color:"red"},class:"customize-btn iconbl bl-delete-line"},null,8,se)]),_:2},1032,["image","title","card-data"]))),128))]),o(M,{style:{padding:"30px","max-height":"500px",overflow:"scroll"},title:"管理合集",modelValue:n.value,"onUpdate:modelValue":s[2]||(s[2]=l=>n.value=l),width:"500px",onClose:f},{default:r(()=>[o($,{ref_key:"collectionFormRef",ref:v,model:t,"label-width":"auto",rules:h},{default:r(()=>[o(ae,{"image-url":t.thumbnailUrl,onSelectFile:T},null,8,["image-url"]),o(_,{label:"合集名称：",prop:"name"},{default:r(()=>[o(x,{modelValue:t.name,"onUpdate:modelValue":s[0]||(s[0]=l=>t.name=l),placeholder:"请输入合集名称"},null,8,["modelValue"])]),_:1}),o(_,{style:{"flex-direction":"column"}},{default:r(()=>[o(w,{onClick:f},{default:r(()=>[I("取消")]),_:1}),o(w,{type:"primary",onClick:s[1]||(s[1]=l=>S(v.value))},{default:r(()=>[I("确定")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}}),we=R(ie,[["__scopeId","data-v-e9ba0070"]]);export{we as default};
