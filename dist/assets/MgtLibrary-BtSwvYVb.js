import{E as D,b as ce,l as de,m as ve,n as pe,o as me,p as fe,q as _e,f as ge}from"./element-plus-D_LIGSL8.js";import{g as z,_ as L}from"./index-DrVw5uU5.js";import{g as ye,h as he,p as Z,i as we,s as be,j as ke}from"./resources-CEwBUTp6.js";import{b as X}from"./vue-router-DaOdIdNP.js";import{d as N,r as l,b as O,o as c,c as g,a as o,T as B,M as F,a7 as q,U as I,S as Ce,u as $,at as j,au as K,I as Y,L as d,P as h,V,x as xe,Z as $e,ak as Ie,J as Q,Q as U}from"./@vue-BV9Q_yhH.js";import{_ as Pe}from"./GWPreviewVideo-DksrPWku.js";import{_ as Ae}from"./GWPreviewImage-tbiejwsO.js";import{F as Se}from"./file-saver-CJAWeVrG.js";import{x as Te,y as Me}from"./@element-plus-DgtNr1CL.js";import"./lodash-es-BDpUAi6D.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-DVUPgnhb.js";import"./dayjs-Dc0JWrkO.js";import"./@ctrl-D_sRHO8g.js";import"./@popperjs-D9SI2xQl.js";import"./pinia-CWZPuNdE.js";import"./axios-Cm0UX6qg.js";import"./vue-pdf-embed-BcRweBTn.js";import"./request_website-QgLrtn7V.js";const ee=r=>(j("data-v-858a8536"),r=r(),K(),r),Ve={class:"class-items"},Ee=ee(()=>o("br",null,null,-1)),Re=ee(()=>o("br",null,null,-1)),Ue={class:"buttons"},De=N({__name:"GWClassifyImage",setup(r){const P=X(),u=l([]);let n=!0;const p=P.params.id;l(1);const w=l(),y=l(),f=l();let m;const v=()=>{if(n){n=!1;const s=document.querySelectorAll(".item");w.value.prepend(s[s.length-1]),setTimeout(()=>n=!0,1e3)}},_=()=>{if(n){n=!1;const s=document.querySelectorAll(".item");w.value.appendChild(s[0]),setTimeout(()=>n=!0,1e3)}},k=async s=>{const e=s.key;if(/^[0-9]$/.test(e)){if(console.log(`按下了数字键：${e}`),u.value){let i={id:u.value[0].id,classification:m.get(Number.parseInt(e))};await he(i),u.value.shift(),u.value.length===5&&t(2,5)}}else s.key.toLowerCase()==="n"?_():s.key.toLowerCase()==="p"&&v()},t=async(s,e)=>{await Z({pageNo:s,pageSize:e,libraryId:p,resourceTypes:[0,3],unclassified:!0}).then(i=>{var A;(A=u.value)==null||A.push(...i.data.result)})};return O(async()=>{y.value&&w.value.focus(),t(1,10),await ye().then(s=>{s.data&&(f.value=s.data,m=new Map(f.value.map(e=>[e.value,e.name])))})}),(s,e)=>(c(),g("div",{class:"container",ref_key:"contaionerRef",ref:y,onKeydown:k,tabindex:"0"},[o("div",Ve,[B(" 分类列表 "),Ee,B(" ------- "),Re,(c(!0),g(F,null,q(f.value,i=>(c(),g("div",{key:i.value},"[ "+I(i.value)+" ] "+I(i.name),1))),128))]),o("div",{ref_key:"slideRef",ref:w,id:"slide"},[(c(!0),g(F,null,q(u.value,i=>(c(),g("div",{class:"item",style:Ce({backgroundImage:`url('${$(z)()+i.previewUrl}')`})},null,4))),256)),o("div",Ue,[o("div",{class:"left",onClick:e[0]||(e[0]=i=>v())},"< Prev"),o("div",{class:"right",onClick:e[1]||(e[1]=i=>_())},"Next >")])],512)],544))}}),Be=L(De,[["__scopeId","data-v-858a8536"]]),Le=r=>(j("data-v-90d20630"),r=r(),K(),r),Ne=["src","alt"],We={class:"more-options"},Ge={key:0,class:"options-div"},ze=Le(()=>o("div",{id:"triangle_bottom"},null,-1)),Fe={class:"options-menu"},qe={key:0},Oe=N({__name:"GWResourceCard",props:{resource:{},onPreview:{type:Function},onCover:{type:Function},onDelete:{type:Function}},setup(r){const P=l(!1),u=l(!1),n=r,{resource:p}=Y(n);O(()=>{});const w=()=>p.value.thumbnailUrl?z()+p.value.thumbnailUrl:"/music.jpeg";function y(){n.onPreview&&n.onPreview(n.resource)}function f(){n.onCover&&n.onCover(n.resource)}function m(){P.value=!1,u.value=!1}const v=()=>{u.value=!u.value},_=async()=>{n.resource.id&&await we(n.resource.id).then(t=>{t.data>0?(D({type:"info",message:"删除成功"}),n.onDelete&&n.onDelete()):D({type:"error",message:"文件删除失败"})})},k=(t,s)=>{fetch(t).then(e=>e.blob()).then(e=>{Se.saveAs(e,s)}).catch(e=>{console.error("Error fetching file:",e),D({type:"error",message:"文件下载异常"})})};return(t,s)=>{const e=ce;return c(),g("div",{class:"resource-card",onMouseover:s[1]||(s[1]=i=>P.value=!0),onMouseleave:m},[o("img",{src:w(),alt:$(p).name,class:"image",onClick:y},null,8,Ne),o("div",We,[o("button",{onClick:v,class:"more-btn"},"⋮"),u.value?(c(),g("div",Ge,[ze,o("div",Fe,[o("ul",null,[$(p).thumbnail==="是"?(c(),g("li",qe,[d(e,{class:"box-item",effect:"dark",content:"库封面",placement:"right"},{default:h(()=>[o("span",{onClick:f,class:"iconbl bl-star-line"})]),_:1})])):V("",!0),o("li",null,[d(e,{class:"box-item",effect:"dark",content:"下载",placement:"right"},{default:h(()=>[o("span",{onClick:s[0]||(s[0]=i=>k($(z)()+$(p).previewUrl,$(p).name)),class:"iconbl bl-download--line"})]),_:1})]),o("li",null,[d(e,{class:"box-item",effect:"dark",content:"删除",placement:"right"},{default:h(()=>[o("span",{onClick:_,class:"iconbl bl-delete-line"})]),_:1})])])])])):V("",!0)])],32)}}}),je=L(Oe,[["__scopeId","data-v-90d20630"]]),Ke=r=>(j("data-v-b723020d"),r=r(),K(),r),He={class:"audio-name"},Je=Ke(()=>o("span",{class:"iconfont icon-audio_frequency"},null,-1)),Qe={class:"controls"},Ze={class:"time-info"},Xe=["max"],Ye={key:0,class:"overlay"},et=N({__name:"GWAudioPreview",props:{url:{},name:{},duration:{}},setup(r,{expose:P}){const u=r,{url:n,name:p,duration:w}=Y(u),y=l(w.value),f=l(!0),m=l(!1),v=l(0),_=l(!1),k=C=>{const b=Math.floor(C/60),a=Math.floor(C%60);return`${String(b).padStart(2,"0")}:${String(a).padStart(2,"0")}`};Array.from({length:10});let t;const s=l(null),e=l(null);let i;const A=async()=>{t||(t=new window.AudioContext),t.state==="suspended"&&await t.resume(),s.value||await G(n.value),T()},W=()=>{f.value?(A(),f.value=!1):m.value?E():T()},T=async()=>{s.value&&(t.state==="suspended"?(t.resume(),console.log("播放中"),m.value=!0,i=setInterval(()=>{t.state==="running"&&(v.value=t.currentTime)},100)):(e.value=t.createBufferSource(),e.value.buffer=s.value,e.value.connect(t.destination),e.value.start(),console.log("播放中..."),m.value=!0,i=setInterval(()=>{t.state==="running"&&(v.value=t.currentTime)},100),e.value.onended=()=>{console.log("播放结束"),m.value=!1,clearInterval(i),v.value=0,t=null,e.value&&(e.value.stop(),e.value=null),f.value=!0}))},E=()=>{t.state==="running"&&t.suspend().then(()=>{console.log("已暂停"),m.value=!1,clearInterval(i)})},G=async C=>{const a=await(await fetch(C)).arrayBuffer();s.value=await new Promise((x,M)=>{t.decodeAudioData(a,S=>{S?(y.value=S.duration,x(S),console.log("音频已加载，准备播放")):M(new Error("音频解码失败"))})})};return xe(()=>{e.value&&e.value.stop(),i&&clearInterval(i)}),P({reset:()=>{f.value=!0,t&&(t.close(),t=null),m.value=!1,v.value=0,_.value=!1,s.value=null,e.value=null}}),(C,b)=>(c(),g("div",{class:"audio-player",onMouseover:b[1]||(b[1]=a=>_.value=!0),onMouseleave:b[2]||(b[2]=a=>_.value=!1)},[o("div",He,I($(p)),1),Je,o("div",Qe,[o("div",Ze,[o("span",null,I(k(v.value)),1),$e(o("input",{type:"range",min:"0",max:y.value,step:"0.1","onUpdate:modelValue":b[0]||(b[0]=a=>v.value=a)},null,8,Xe),[[Ie,v.value]]),o("span",null,I(k(y.value)),1)])]),_.value?(c(),g("div",Ye,[o("div",{class:"play-button",onClick:W},I(m.value?"⏸️":"▶️"),1)])):V("",!0)],32))}}),tt=L(et,[["__scopeId","data-v-b723020d"]]),at={class:"root-container"},st={style:{"text-align":"right",display:"inline-block",width:"100%"}},ot={style:{"text-align":"right",display:"inline-block",width:"100%"}},nt={key:0,class:"resource-gallery"},lt={style:{width:"100%"}},it=N({__name:"MgtLibrary",setup(r){const u=X().params.id,n=l("1"),p=l(0),w=l(0),y=l(1),f=l(20),m=function(a,x){n.value=a},v=l(),_=l(!1),k=l(!1),t=l(!1),s=l(),e=l({}),i=a=>{a.resourceType==="视频"?W(a):a.resourceType==="音频"?T(a):A(a)},A=a=>{e.value=a,_.value=!0},W=a=>{k.value=!0,e.value=a},T=a=>{t.value=!0,e.value=a},E=()=>{_.value=!1,k.value=!1},G=()=>{s.value.reset(),t.value=!1},H=async a=>{let x={id:u,cover:a.id};await ke(x).then(M=>{D({type:"info",message:"库封面设置成功"})})},C=async()=>{await Z({pageNo:y.value,pageSize:f.value,libraryId:u}).then(a=>{v.value=a.data.result,p.value=a.data.total})},b=a=>{y.value=a,C()};return O(async()=>{C(),await be({libraryId:u,resourceTypes:[0,3],unclassified:!0}).then(a=>{w.value=a.data.unclassified})}),(a,x)=>{const M=ve,S=pe,te=me,ae=fe,se=je,oe=_e,ne=Ae,le=Pe,ie=ge,re=Be,J=de;return c(),g("div",at,[d(J,{class:"layout-container-demo"},{default:h(()=>[d(ae,{width:"200px"},{default:h(()=>[d(te,{"default-active":n.value,onSelect:m},{default:h(()=>[d(S,{index:"1",class:Q(n.value==="1"?"selectTab":"")},{title:h(()=>[d(M,null,{default:h(()=>[d($(Te))]),_:1}),B("全部 "),o("span",st,I(p.value),1)]),_:1},8,["class"]),d(S,{index:"2",class:Q(n.value==="2"?"selectTab":"")},{title:h(()=>[d(M,null,{default:h(()=>[d($(Me))]),_:1}),B("待分类图片 "),o("span",ot,I(w.value),1)]),_:1},8,["class"])]),_:1},8,["default-active"])]),_:1}),d(J,{class:"right-container"},{default:h(()=>[n.value==="1"?(c(),g("div",nt,[(c(!0),g(F,null,q(v.value,(R,ue)=>(c(),U(se,{key:ue,resource:R,"on-preview":i,"on-cover":H,"on-delete":C},null,8,["resource"]))),128)),o("div",lt,[d(oe,{style:{"flex-direction":"row-reverse"},background:"",layout:"prev, pager, next",total:p.value,"pager-count":5,"page-size":f.value,"current-page":y.value,onCurrentChange:b},null,8,["total","page-size","current-page"])]),_.value?(c(),U(ne,{key:0,resource:e.value.previewUrl,name:e.value.name,"on-close":E},null,8,["resource","name"])):V("",!0),k.value?(c(),U(le,{key:1,url:e.value.previewUrl,name:e.value.name,"on-close":E},null,8,["url","name"])):V("",!0),d(ie,{style:{padding:"30px","min-height":"200px"},title:"音频预览",modelValue:t.value,"onUpdate:modelValue":x[0]||(x[0]=R=>t.value=R),onClose:x[1]||(x[1]=R=>G())},{default:h(()=>[d(tt,{ref_key:"audioPreviewRef",ref:s,name:e.value.name,duration:e.value.duration,url:e.value.previewUrl,class:"img-item"},null,8,["name","duration","url"])]),_:1},8,["modelValue"])])):(c(),U(re,{key:1}))]),_:1})]),_:1})])}}}),Pt=L(it,[["__scopeId","data-v-31ac0f83"]]);export{Pt as default};
