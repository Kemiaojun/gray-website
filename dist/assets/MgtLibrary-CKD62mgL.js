import{E as z,k as ce,l as de,m as ve,n as pe,o as me,p as fe,q as _e,d as ge}from"./element-plus-COxNbMku.js";import{b as W,_ as D}from"./index-D5opSzIJ.js";import{g as ye,h as he,p as J,i as we,s as be,j as ke}from"./resources-CXxAkQFS.js";import{b as Q}from"./vue-router-DaOdIdNP.js";import{d as F,r as l,b as H,o as r,c as f,a as o,T as B,M as G,a7 as q,U as P,S as Ce,u as C,at as Z,au as X,I as Y,L as c,P as h,V,x as xe,Z as $e,ak as Ie,J as K,Q as U}from"./@vue-BV9Q_yhH.js";import{_ as Pe}from"./GWPreviewVideo-BeObDPcH.js";import{_ as Ae}from"./GWPreviewImage-DXtp0tZu.js";import{F as Se}from"./file-saver-BRKk3X6M.js";import{x as Me,y as Te}from"./@element-plus-DgtNr1CL.js";import"./lodash-es-BDpUAi6D.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-DVUPgnhb.js";import"./dayjs-Didlxlvp.js";import"./@ctrl-D_sRHO8g.js";import"./@popperjs-D9SI2xQl.js";import"./pinia-CWZPuNdE.js";import"./axios-Cm0UX6qg.js";import"./vue-pdf-embed-BcRweBTn.js";import"./request_website-rgn5jgna.js";const ee=v=>(Z("data-v-858a8536"),v=v(),X(),v),Ve={class:"class-items"},Ee=ee(()=>o("br",null,null,-1)),Re=ee(()=>o("br",null,null,-1)),Ue={class:"buttons"},ze=F({__name:"GWClassifyImage",setup(v){const I=Q(),u=l([]);let n=!0;const p=I.params.id;l(1);const w=l(),y=l(),_=l();let m;const d=()=>{if(n){n=!1;const s=document.querySelectorAll(".item");w.value.prepend(s[s.length-1]),setTimeout(()=>n=!0,1e3)}},g=()=>{if(n){n=!1;const s=document.querySelectorAll(".item");w.value.appendChild(s[0]),setTimeout(()=>n=!0,1e3)}},k=async s=>{const e=s.key;if(/^[0-9]$/.test(e)){if(console.log(`按下了数字键：${e}`),u.value){let i={id:u.value[0].id,classification:m.get(Number.parseInt(e))};await he(i),u.value.shift(),u.value.length===5&&t(2,5)}}else s.key.toLowerCase()==="n"?g():s.key.toLowerCase()==="p"&&d()},t=async(s,e)=>{await J({pageNo:s,pageSize:e,libraryId:p,resourceTypes:[0,3],unclassified:!0}).then(i=>{var A;(A=u.value)==null||A.push(...i.data.result)})};return H(async()=>{y.value&&w.value.focus(),t(1,10),await ye().then(s=>{s.data&&(_.value=s.data,m=new Map(_.value.map(e=>[e.value,e.name])))})}),(s,e)=>(r(),f("div",{class:"container",ref_key:"contaionerRef",ref:y,onKeydown:k,tabindex:"0"},[o("div",Ve,[B(" 分类列表 "),Ee,B(" ------- "),Re,(r(!0),f(G,null,q(_.value,i=>(r(),f("div",{key:i.value},"[ "+P(i.value)+" ] "+P(i.name),1))),128))]),o("div",{ref_key:"slideRef",ref:w,id:"slide"},[(r(!0),f(G,null,q(u.value,i=>(r(),f("div",{class:"item",style:Ce({backgroundImage:`url('${C(W)()+i.previewUrl}')`})},null,4))),256)),o("div",Ue,[o("div",{class:"left",onClick:e[0]||(e[0]=i=>d())},"< Prev"),o("div",{class:"right",onClick:e[1]||(e[1]=i=>g())},"Next >")])],512)],544))}}),Be=D(ze,[["__scopeId","data-v-858a8536"]]),De=v=>(Z("data-v-90d20630"),v=v(),X(),v),Fe=["src","alt"],Le={class:"more-options"},Ne={key:0,class:"options-div"},We=De(()=>o("div",{id:"triangle_bottom"},null,-1)),Ge={class:"options-menu"},qe={key:0},He=F({__name:"GWResourceCard",props:{resource:{},onPreview:{type:Function},onCover:{type:Function},onDelete:{type:Function}},setup(v){const I=l(!1),u=l(!1),n=v,{resource:p}=Y(n);H(()=>{});const w=()=>p.value.thumbnailUrl?W()+p.value.thumbnailUrl:"/music.jpeg";function y(){n.onPreview&&n.onPreview(n.resource)}function _(){n.onCover&&n.onCover(n.resource)}function m(){I.value=!1,u.value=!1}const d=()=>{u.value=!u.value},g=async()=>{n.resource.id&&await we(n.resource.id).then(t=>{t.data>0?(z({type:"info",message:"删除成功"}),n.onDelete&&n.onDelete()):z({type:"error",message:"文件删除失败"})})},k=(t,s)=>{fetch(t).then(e=>e.blob()).then(e=>{Se.saveAs(e,s)}).catch(e=>{console.error("Error fetching file:",e),z({type:"error",message:"文件下载异常"})})};return(t,s)=>{const e=ce;return r(),f("div",{class:"resource-card",onMouseover:s[1]||(s[1]=i=>I.value=!0),onMouseleave:m},[o("img",{src:w(),alt:C(p).name,class:"image",onClick:y},null,8,Fe),o("div",Le,[o("button",{onClick:d,class:"more-btn"},"⋮"),u.value?(r(),f("div",Ne,[We,o("div",Ge,[o("ul",null,[C(p).thumbnail==="是"?(r(),f("li",qe,[c(e,{class:"box-item",effect:"dark",content:"库封面",placement:"right"},{default:h(()=>[o("span",{onClick:_,class:"iconbl bl-star-line"})]),_:1})])):V("",!0),o("li",null,[c(e,{class:"box-item",effect:"dark",content:"下载",placement:"right"},{default:h(()=>[o("span",{onClick:s[0]||(s[0]=i=>k(C(W)()+C(p).previewUrl,C(p).name)),class:"iconbl bl-download--line"})]),_:1})]),o("li",null,[c(e,{class:"box-item",effect:"dark",content:"删除",placement:"right"},{default:h(()=>[o("span",{onClick:g,class:"iconbl bl-delete-line"})]),_:1})])])])])):V("",!0)])],32)}}}),Oe=D(He,[["__scopeId","data-v-90d20630"]]),je={xmlns:"http://www.w3.org/2000/svg",width:"200",height:"200",class:"icon",viewBox:"0 0 1024 1024"},Ke=o("path",{fill:"#565656",d:"M106.667 512c1.834-134.357 25.173-245.59 93.397-311.936C266.411 131.84 377.643 108.501 512 106.667c134.357 1.834 245.59 25.173 311.936 93.397C892.16 266.411 915.499 377.643 917.333 512c-1.834 134.357-25.173 245.59-93.397 311.936C757.589 892.16 646.357 915.499 512 917.333c-134.357-1.834-245.59-25.173-311.936-93.397C131.84 757.589 108.501 646.357 106.667 512"},null,-1),Je=o("path",{fill:"#FFF",d:"M618.667 405.333v213.334H576V405.333zm-170.667 0v213.334h-42.667V405.333zm-85.333 64v85.334H320v-85.334zm341.333 0v85.334h-42.667v-85.334zm-170.667-128v341.334h-42.666V341.333z"},null,-1),Qe=[Ke,Je];function Ze(v,I){return r(),f("svg",je,[...Qe])}const Xe={render:Ze},Ye={class:"audio-name"},et={class:"controls"},tt={class:"time-info"},at=["max"],st={key:0,class:"overlay"},ot=F({__name:"GWAudioPreview",props:{url:{},name:{},duration:{}},setup(v,{expose:I}){const u=v,{url:n,name:p,duration:w}=Y(u),y=l(w.value),_=l(!0),m=l(!1),d=l(0),g=l(!1),k=x=>{const b=Math.floor(x/60),a=Math.floor(x%60);return`${String(b).padStart(2,"0")}:${String(a).padStart(2,"0")}`};Array.from({length:10});let t;const s=l(null),e=l(null);let i;const A=async()=>{t||(t=new window.AudioContext),t.state==="suspended"&&await t.resume(),s.value||await N(n.value),M()},L=()=>{_.value?(A(),_.value=!1):m.value?E():M()},M=async()=>{s.value&&(t.state==="suspended"?(t.resume(),console.log("播放中"),m.value=!0,i=setInterval(()=>{t.state==="running"&&(d.value=t.currentTime)},100)):(e.value=t.createBufferSource(),e.value.buffer=s.value,e.value.connect(t.destination),e.value.start(),console.log("播放中..."),m.value=!0,i=setInterval(()=>{t.state==="running"&&(d.value=t.currentTime)},100),e.value.onended=()=>{console.log("播放结束"),m.value=!1,clearInterval(i),d.value=0,t=null,e.value&&(e.value.stop(),e.value=null),_.value=!0}))},E=()=>{t.state==="running"&&t.suspend().then(()=>{console.log("已暂停"),m.value=!1,clearInterval(i)})},N=async x=>{const a=await(await fetch(x)).arrayBuffer();s.value=await new Promise(($,T)=>{t.decodeAudioData(a,S=>{S?(y.value=S.duration,$(S),console.log("音频已加载，准备播放")):T(new Error("音频解码失败"))})})};return xe(()=>{e.value&&e.value.stop(),i&&clearInterval(i)}),I({reset:()=>{_.value=!0,t&&(t.close(),t=null),m.value=!1,d.value=0,g.value=!1,s.value=null,e.value=null}}),(x,b)=>(r(),f("div",{class:"audio-player",onMouseover:b[1]||(b[1]=a=>g.value=!0),onMouseleave:b[2]||(b[2]=a=>g.value=!1)},[o("div",Ye,P(C(p)),1),c(C(Xe)),o("div",et,[o("div",tt,[o("span",null,P(k(d.value)),1),$e(o("input",{type:"range",min:"0",max:y.value,step:"0.1","onUpdate:modelValue":b[0]||(b[0]=a=>d.value=a)},null,8,at),[[Ie,d.value]]),o("span",null,P(k(y.value)),1)])]),g.value?(r(),f("div",st,[o("div",{class:"play-button",onClick:L},P(m.value?"⏸️":"▶️"),1)])):V("",!0)],32))}}),nt=D(ot,[["__scopeId","data-v-88c9647e"]]),lt={class:"root-container"},it={style:{"text-align":"right",display:"inline-block",width:"100%"}},rt={style:{"text-align":"right",display:"inline-block",width:"100%"}},ut={key:0,class:"resource-gallery"},ct={style:{width:"100%"}},dt=F({__name:"MgtLibrary",setup(v){const u=Q().params.id,n=l("1"),p=l(0),w=l(0),y=l(1),_=l(20),m=function(a,$){n.value=a},d=l(),g=l(!1),k=l(!1),t=l(!1),s=l(),e=l({}),i=a=>{a.resourceType==="视频"?L(a):a.resourceType==="音频"?M(a):A(a)},A=a=>{e.value=a,g.value=!0},L=a=>{k.value=!0,e.value=a},M=a=>{t.value=!0,e.value=a},E=()=>{g.value=!1,k.value=!1},N=()=>{s.value.reset(),t.value=!1},O=async a=>{let $={id:u,cover:a.id};await ke($).then(T=>{z({type:"info",message:"库封面设置成功"})})},x=async()=>{await J({pageNo:y.value,pageSize:_.value,libraryId:u}).then(a=>{d.value=a.data.result,p.value=a.data.total})},b=a=>{y.value=a,x()};return H(async()=>{x(),await be({libraryId:u,resourceTypes:[0,3],unclassified:!0}).then(a=>{w.value=a.data.unclassified})}),(a,$)=>{const T=ve,S=pe,te=me,ae=fe,se=Oe,oe=_e,ne=Ae,le=Pe,ie=ge,re=Be,j=de;return r(),f("div",lt,[c(j,{class:"layout-container-demo"},{default:h(()=>[c(ae,{width:"200px"},{default:h(()=>[c(te,{"default-active":n.value,onSelect:m},{default:h(()=>[c(S,{index:"1",class:K(n.value==="1"?"selectTab":"")},{title:h(()=>[c(T,null,{default:h(()=>[c(C(Me))]),_:1}),B("全部 "),o("span",it,P(p.value),1)]),_:1},8,["class"]),c(S,{index:"2",class:K(n.value==="2"?"selectTab":"")},{title:h(()=>[c(T,null,{default:h(()=>[c(C(Te))]),_:1}),B("待分类图片 "),o("span",rt,P(w.value),1)]),_:1},8,["class"])]),_:1},8,["default-active"])]),_:1}),c(j,{class:"right-container"},{default:h(()=>[n.value==="1"?(r(),f("div",ut,[(r(!0),f(G,null,q(d.value,(R,ue)=>(r(),U(se,{key:ue,resource:R,"on-preview":i,"on-cover":O,"on-delete":x},null,8,["resource"]))),128)),o("div",ct,[c(oe,{style:{"flex-direction":"row-reverse"},background:"",layout:"prev, pager, next",total:p.value,"pager-count":5,"page-size":_.value,"current-page":y.value,onCurrentChange:b},null,8,["total","page-size","current-page"])]),g.value?(r(),U(ne,{key:0,resource:e.value.previewUrl,name:e.value.name,"on-close":E},null,8,["resource","name"])):V("",!0),k.value?(r(),U(le,{key:1,url:e.value.previewUrl,name:e.value.name,"on-close":E},null,8,["url","name"])):V("",!0),c(ie,{style:{padding:"30px","min-height":"200px"},title:"音频预览",modelValue:t.value,"onUpdate:modelValue":$[0]||($[0]=R=>t.value=R),onClose:$[1]||($[1]=R=>N())},{default:h(()=>[c(nt,{ref_key:"audioPreviewRef",ref:s,name:e.value.name,duration:e.value.duration,url:e.value.previewUrl,class:"img-item"},null,8,["name","duration","url"])]),_:1},8,["modelValue"])])):(r(),U(re,{key:1}))]),_:1})]),_:1})])}}}),Tt=D(dt,[["__scopeId","data-v-31ac0f83"]]);export{Tt as default};
