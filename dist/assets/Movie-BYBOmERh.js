import{E as oe,q as ne,d as se,c as re,f as ie,g as ce,h as ue,i as de,b as me}from"./element-plus-COxNbMku.js";import{_ as pe}from"./GWPreviewVideo-DDR-64g0.js";import{_ as _e}from"./GWSearchCondition-ChiNV3yt.js";import{_ as z,b as B,f as fe}from"./index-DX23uGLL.js";import{u as ve}from"./vue-router-DaOdIdNP.js";import{d as h}from"./request_website-Dmp0XFvh.js";import{c as f,D as ge,o as u,d as q,I as he,a as s,u as I,U as G,ab as P,r as i,H as ye,w as we,b as xe,L as l,P as r,Q as D,V as be,M as F,a7 as R,T as W,at as ke,au as Ve}from"./@vue-BV9Q_yhH.js";import"./lodash-es-BDpUAi6D.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-DVUPgnhb.js";import"./dayjs-Didlxlvp.js";import"./@element-plus-DgtNr1CL.js";import"./@ctrl-D_sRHO8g.js";import"./@popperjs-D9SI2xQl.js";import"./pinia-CWZPuNdE.js";import"./axios-Cm0UX6qg.js";import"./vue-pdf-embed-BcRweBTn.js";const Ce=n=>{const t={headers:{"Content-Type":"multipart/form-data"}};return h.post("/movie/cover",n,t)},De=()=>h.get("/movie/refresh"),Fe=()=>h.get("/movie/categories"),Ie=n=>h.post("/movie/page",{...n}),Ne=n=>h.post("/movie/m3u8",{...n}),Se={},Re={class:"gw-flex-container"};function ze(n,t){return u(),f("div",Re,[ge(n.$slots,"flex-items",{},void 0,!0)])}const Ee=z(Se,[["render",ze],["__scopeId","data-v-4688a806"]]),Ue={class:"gw-flex-item"},$e={class:"gw-flex-card"},Me=["src"],Ae={class:"gw-flex-info"},Te={class:"movie-title"},Be=q({__name:"GWFlexImage",props:{title:{},src:{},itemData:{},play:{type:Function},click:{type:Function}},setup(n){const t=n,{src:v,title:y}=he(t);function w(){if(t!=null&&t.click){const c=t.itemData?P(t.itemData):{};t.click(c)}}function g(){if(t!=null&&t.play){const c=t.itemData?P(t.itemData):{};t.play(c)}}return(c,x)=>(u(),f("div",Ue,[s("div",$e,[s("img",{onclick:w,src:I(v),onerror:"this.onerror=null;this.src='/favicon.png';",alt:"Sorry, something went wrong"},null,8,Me),s("div",Ae,[s("h3",Te,G(I(y)),1),s("h3",{class:"movie-play",onclick:g},"Play")])])]))}}),Pe=z(Be,[["__scopeId","data-v-4f650451"]]),L=n=>(ke("data-v-0ab37dea"),n=n(),Ve(),n),We={class:"image-gallery"},qe={class:"flex-item"},Ge={class:"flex-item"},Le=L(()=>s("span",{style:{"font-size":"small",color:"var(--gw-font-color)"}},"影片数量: ",-1)),He={style:{"font-size":"small",color:"var(--gw-font-color)","font-style":"italic","font-weight":"bold","text-decoration":"underline"}},Oe={class:"flex-item",style:{"margin-left":"20px"}},Qe=L(()=>s("span",{width:"30px"},null,-1)),je={style:{width:"100%"}},Je=q({__name:"Movie",setup(n){ve();const t=i(0),v=i(1),y=i(20),w=i(),g=i(!1),c=i(),x=i(),E=i(),b=i(),d=i({name:"",folderName:"",url:""}),H=ye({name:[{required:!0,message:"请输入电影名称",trigger:"blur"}],folderName:[{required:!0,message:"请选择电影所属分类",trigger:"blur"}],url:[{required:!0,message:"请输入m3u8 url地址",trigger:"blur"}]}),k=i(!1),N=()=>{k.value=!1},O=()=>{k.value=!0},Q=async o=>{o&&await o.validate(async(a,m)=>{a?(Ne(d.value),N()):console.log("error submit!",m)})},j=o=>{c.value=o,U.value.click()},J=o=>{c.value=o,g.value=!0},K=o=>{v.value=o,S()},S=async()=>{await Ie({pageNo:v.value,pageSize:y.value,folderName:b.value}).then(o=>{w.value=o.data.result,t.value=o.data.total})},U=i(),X=async o=>{if(c.value){const a=o.target;if(a.files&&a.files[0]){const m=new FileReader;m.onload=_=>{var V;(V=_.target)==null||V.result},m.readAsDataURL(a.files[0]);let p=new FormData;p.append("file",a.files[0]),p.append("id",c.value.id+""),await Ce(p).then(_=>{debugger;_.data&&oe({type:"info",message:"电影海报已更新，请刷新页面查看"})}).finally(()=>{})}}},Y=()=>{g.value=!1};we(()=>b.value,()=>{S()},{deep:!0,immediate:!0});const Z=()=>{De()};return xe(async()=>{S(),await Fe().then(o=>{x.value=o.data})}),(o,a)=>{var A,T;const m=me,p=re,_=fe,V=_e,ee=pe,te=ne,$=ie,C=ce,M=ue,ae=de,le=se;return u(),f(F,null,[s("div",We,[l(V,null,{"left-items":r(()=>[s("div",qe,[l(p,{modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=e=>b.value=e),clearable:"",placeholder:"分类",style:{width:"150px"}},{default:r(()=>[(u(!0),f(F,null,R(x.value,e=>(u(),D(m,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),"right-items":r(()=>[s("div",Ge,[Le,s("span",He,G(t.value),1),s("div",Oe,[l(_,{size:20,"icon-class":"m3u8",class:"svg-icon",onclick:O}),Qe,l(_,{size:20,"icon-class":"refresh",class:"svg-icon",onclick:Z})])])]),_:1}),l(Ee,{style:{"min-height":"calc(100% - 100px)"}},{"flex-items":r(()=>[(u(!0),f(F,null,R(w.value,(e,Ke)=>(u(),D(Pe,{click:j,play:J,title:e.title,"item-data":e,src:I(B)()+e.coverUrl},null,8,["title","item-data","src"]))),256))]),_:1}),s("input",{ref_key:"fileselectRef",ref:U,style:{display:"none"},type:"file",accept:"image/*",onChange:X},null,544),g.value?(u(),D(ee,{key:0,url:I(B)()+((A=c.value)==null?void 0:A.previewUrl),name:(T=c.value)==null?void 0:T.title,"on-close":Y},null,8,["url","name"])):be("",!0),s("div",je,[l(te,{style:{"flex-direction":"row-reverse"},background:"",layout:"prev, pager, next",total:t.value,"pager-count":5,"page-size":y.value,"current-page":v.value,onCurrentChange:K},null,8,["total","page-size","current-page"])])]),l(le,{style:{padding:"30px","max-height":"500px",overflow:"scroll"},title:"m3u8解析",modelValue:k.value,"onUpdate:modelValue":a[5]||(a[5]=e=>k.value=e),width:"500px",onClose:N},{default:r(()=>[l(ae,{ref_key:"m3u8FormRef",ref:E,model:d.value,"label-width":"auto",rules:H},{default:r(()=>[l(C,{label:"电影名称：",prop:"name"},{default:r(()=>[l($,{modelValue:d.value.name,"onUpdate:modelValue":a[1]||(a[1]=e=>d.value.name=e),placeholder:"请输入电影名称"},null,8,["modelValue"])]),_:1}),l(C,{label:"所属分类：",prop:"folderName"},{default:r(()=>[l(p,{modelValue:d.value.folderName,"onUpdate:modelValue":a[2]||(a[2]=e=>d.value.folderName=e),filterable:"",placeholder:"请选择所属分类",style:{width:"200px"}},{default:r(()=>[(u(!0),f(F,null,R(x.value,e=>(u(),D(m,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(C,{label:"解析地址：",prop:"url"},{default:r(()=>[l($,{size:"small",type:"textarea",placeholder:"解析地址",modelValue:d.value.url,"onUpdate:modelValue":a[3]||(a[3]=e=>d.value.url=e),resize:"none",rows:4},null,8,["modelValue"])]),_:1}),l(C,{style:{"flex-direction":"column"}},{default:r(()=>[l(M,{onClick:N},{default:r(()=>[W("取消")]),_:1}),l(M,{type:"primary",onClick:a[4]||(a[4]=e=>Q(E.value))},{default:r(()=>[W("确定")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}}),_t=z(Je,[["__scopeId","data-v-0ab37dea"]]);export{_t as default};
