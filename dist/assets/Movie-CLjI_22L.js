import{E as ne,q as se,d as re,c as ie,f as ue,g as ce,h as me,i as de,b as pe}from"./element-plus-COxNbMku.js";import{_ as fe}from"./GWPreviewVideo-B5p3-dox.js";import{_ as _e}from"./GWSearchCondition-CQT2XalU.js";import{_ as z,b as B,f as ve}from"./index-C2ldJ7wi.js";import{u as ge}from"./vue-router-DaOdIdNP.js";import{d as y}from"./request_website-Bvo4zYtG.js";import{c as _,D as he,o as c,d as q,I as ye,a as s,u as I,U as G,ab as P,r,H as we,w as xe,b as Ve,L as a,P as i,Q as D,V as be,M as F,a7 as U,T as W,at as ke,au as Ce}from"./@vue-BV9Q_yhH.js";import"./lodash-es-BDpUAi6D.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-DVUPgnhb.js";import"./dayjs-Didlxlvp.js";import"./@element-plus-DgtNr1CL.js";import"./@ctrl-D_sRHO8g.js";import"./@popperjs-D9SI2xQl.js";import"./pinia-CWZPuNdE.js";import"./axios-Cm0UX6qg.js";import"./vue-pdf-embed-BcRweBTn.js";const Ne=n=>{const l={headers:{"Content-Type":"multipart/form-data"}};return y.post("/movie/cover",n,l)},De=()=>y.get("/movie/refresh"),Fe=()=>y.get("/movie/categories"),Ie=n=>y.post("/movie/page",{...n}),Se=n=>y.post("/movie/m3u8",{...n}),Re={},Ue={class:"gw-flex-container"};function ze(n,l){return c(),_("div",Ue,[he(n.$slots,"flex-items",{},void 0,!0)])}const Ee=z(Re,[["render",ze],["__scopeId","data-v-4688a806"]]),$e={class:"gw-flex-item"},Me={class:"gw-flex-card"},Ae=["src"],Te={class:"gw-flex-info"},Be={class:"movie-title"},Pe=q({__name:"GWFlexImage",props:{title:{},src:{},itemData:{},play:{type:Function},click:{type:Function}},setup(n){const l=n,{src:v,title:w}=ye(l);function x(){if(l!=null&&l.click){const u=l.itemData?P(l.itemData):{};l.click(u)}}function g(){if(l!=null&&l.play){const u=l.itemData?P(l.itemData):{};l.play(u)}}return(u,V)=>(c(),_("div",$e,[s("div",Me,[s("img",{onclick:x,src:I(v),onerror:"this.onerror=null;this.src='/favicon.png';",alt:"Sorry, something went wrong"},null,8,Ae),s("div",Te,[s("h3",Be,G(I(w)),1),s("h3",{class:"movie-play",onclick:g},"Play")])])]))}}),We=z(Pe,[["__scopeId","data-v-4f650451"]]),L=n=>(ke("data-v-986244ef"),n=n(),Ce(),n),qe={class:"movie-gallery"},Ge={class:"flex-item"},Le={class:"flex-item"},He=L(()=>s("span",{style:{"font-size":"small",color:"var(--gw-font-color)"}},"影片数量: ",-1)),Oe={style:{"font-size":"small",color:"var(--gw-font-color)","font-style":"italic","font-weight":"bold","text-decoration":"underline"}},Qe={class:"flex-item",style:{"margin-left":"20px"}},je=L(()=>s("span",{width:"30px"},null,-1)),Je={style:{width:"100%"}},Ke=q({__name:"Movie",setup(n){ge();const l=r(0),v=r(1),w=r(10),x=r(),g=r(!1),u=r(),V=r(),E=r(),b=r(),k=r(),m=r({name:"",folderName:"",url:""}),H=we({name:[{required:!0,message:"请输入电影名称",trigger:"blur"}],folderName:[{required:!0,message:"请选择电影所属分类",trigger:"blur"}],url:[{required:!0,message:"请输入m3u8 url地址",trigger:"blur"}]}),C=r(!1),S=()=>{C.value=!1},O=()=>{C.value=!0},Q=async o=>{o&&await o.validate(async(t,d)=>{t?(Se(m.value),S()):console.log("error submit!",d)})},j=o=>{u.value=o,$.value.click()},J=o=>{u.value=o,g.value=!0},K=o=>{v.value=o,R()},R=async()=>{await Ie({pageNo:v.value,pageSize:w.value,folderName:b.value,name:k.value}).then(o=>{x.value=o.data.result,l.value=o.data.total})},$=r(),X=async o=>{if(u.value){const t=o.target;if(t.files&&t.files[0]){const d=new FileReader;d.onload=p=>{var h;(h=p.target)==null||h.result},d.readAsDataURL(t.files[0]);let f=new FormData;f.append("file",t.files[0]),f.append("id",u.value.id+""),await Ne(f).then(p=>{debugger;p.data&&ne({type:"info",message:"电影海报已更新，请刷新页面查看"})}).finally(()=>{})}}},Y=()=>{g.value=!1};xe(()=>[b.value,k.value],()=>{R()},{deep:!0,immediate:!0});const Z=()=>{De()};return Ve(async()=>{R(),await Fe().then(o=>{V.value=o.data})}),(o,t)=>{var A,T;const d=pe,f=ie,p=ue,h=ve,ee=_e,te=fe,le=se,N=ce,M=me,ae=de,oe=re;return c(),_(F,null,[s("div",qe,[a(ee,null,{"left-items":i(()=>[s("div",Ge,[a(f,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=e=>b.value=e),clearable:"",placeholder:"分类",style:{width:"150px"}},{default:i(()=>[(c(!0),_(F,null,U(V.value,e=>(c(),D(d,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(p,{style:{"margin-left":"10px"},modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=e=>k.value=e),placeholder:"电影名称"},null,8,["modelValue"])])]),"right-items":i(()=>[s("div",Le,[He,s("span",Oe,G(l.value),1),s("div",Qe,[a(h,{size:20,"icon-class":"m3u8",class:"svg-icon",onclick:O}),je,a(h,{size:20,"icon-class":"refresh",class:"svg-icon",onclick:Z})])])]),_:1}),a(Ee,{style:{"min-height":"calc(100% - 100px)"}},{"flex-items":i(()=>[(c(!0),_(F,null,U(x.value,(e,Xe)=>(c(),D(We,{click:j,play:J,title:e.title,"item-data":e,src:I(B)()+e.coverUrl},null,8,["title","item-data","src"]))),256))]),_:1}),s("input",{ref_key:"fileselectRef",ref:$,style:{display:"none"},type:"file",accept:"image/*",onChange:X},null,544),g.value?(c(),D(te,{key:0,url:I(B)()+((A=u.value)==null?void 0:A.previewUrl),name:(T=u.value)==null?void 0:T.title,"on-close":Y},null,8,["url","name"])):be("",!0),s("div",Je,[a(le,{style:{"flex-direction":"row-reverse"},background:"",layout:"prev, pager, next",total:l.value,"pager-count":5,"page-size":w.value,"current-page":v.value,onCurrentChange:K},null,8,["total","page-size","current-page"])])]),a(oe,{style:{padding:"30px","max-height":"500px",overflow:"scroll"},title:"m3u8解析",modelValue:C.value,"onUpdate:modelValue":t[6]||(t[6]=e=>C.value=e),width:"500px",onClose:S},{default:i(()=>[a(ae,{ref_key:"m3u8FormRef",ref:E,model:m.value,"label-width":"auto",rules:H},{default:i(()=>[a(N,{label:"电影名称：",prop:"name"},{default:i(()=>[a(p,{modelValue:m.value.name,"onUpdate:modelValue":t[2]||(t[2]=e=>m.value.name=e),placeholder:"请输入电影名称"},null,8,["modelValue"])]),_:1}),a(N,{label:"所属分类：",prop:"folderName"},{default:i(()=>[a(f,{modelValue:m.value.folderName,"onUpdate:modelValue":t[3]||(t[3]=e=>m.value.folderName=e),filterable:"",placeholder:"请选择所属分类",style:{width:"200px"}},{default:i(()=>[(c(!0),_(F,null,U(V.value,e=>(c(),D(d,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(N,{label:"解析地址：",prop:"url"},{default:i(()=>[a(p,{size:"small",type:"textarea",placeholder:"解析地址",modelValue:m.value.url,"onUpdate:modelValue":t[4]||(t[4]=e=>m.value.url=e),resize:"none",rows:4},null,8,["modelValue"])]),_:1}),a(N,{style:{"flex-direction":"column"}},{default:i(()=>[a(M,{onClick:S},{default:i(()=>[W("取消")]),_:1}),a(M,{type:"primary",onClick:t[5]||(t[5]=e=>Q(E.value))},{default:i(()=>[W("确定")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}}),_t=z(Ke,[["__scopeId","data-v-986244ef"]]);export{_t as default};
