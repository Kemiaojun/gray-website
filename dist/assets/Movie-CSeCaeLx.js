import{k as ae,E as oe,q as ne,d as se,b as ie,c as re,f as ue,g as ce,h as de,i as me}from"./element-plus-COxNbMku.js";import{_ as pe}from"./GWPreviewVideo-F6uck7uG.js";import{_ as ve}from"./GWSearchCondition-DSTU7x9g.js";import{_ as A,b as P,f as fe}from"./index-CkoR0yg0.js";import{u as _e}from"./vue-router-DaOdIdNP.js";import{m as ge,p as he,a as ye,b as xe,c as we}from"./movie-DBh3bMuc.js";import{c as m,D as ke,o as c,d as W,I as be,r as s,h as Ve,a as i,u as f,S as Ce,M,a7 as E,Q as U,P as r,U as I,L as o,ab as Ne,H as ze,w as Fe,b as Se,V as Me,T as G,at as Ue,au as $e}from"./@vue-BV9Q_yhH.js";import"./lodash-es-BDpUAi6D.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-DVUPgnhb.js";import"./dayjs-Didlxlvp.js";import"./@element-plus-DgtNr1CL.js";import"./@ctrl-D_sRHO8g.js";import"./@popperjs-D9SI2xQl.js";import"./pinia-CWZPuNdE.js";import"./axios-Cm0UX6qg.js";import"./vue-pdf-embed-BcRweBTn.js";import"./request_website-0aNKkAX2.js";const Ee={},Ie={class:"gw-flex-container"};function Re(p,u){return c(),m("div",Ie,[ke(p.$slots,"flex-items",{},void 0,!0)])}const Be=A(Ee,[["render",Re],["__scopeId","data-v-4688a806"]]),Ae={class:"gw-flex-item"},De={class:"gw-flex-card"},Te={class:"img-card"},Pe=["src"],Ge=["fileName"],We={class:"gw-flex-info"},qe={class:"movie-title"},Le=W({__name:"GWFlexMovieCard",props:{movie:{},play:{type:Function},click:{type:Function}},setup(p){const u=p,{movie:n}=be(u),k=s(n.value.previewUrl),b=s(n.value.title),_=s(!1);let y=Ve(()=>{if(n.value.size){if(n.value.series=="是")return" [共"+n.value.size+"集]";{let t=n.value.size/1024;if(t<1024)return" ["+t.toFixed(2)+"KB]";if(t=t/1024,t<1024)return" ["+t.toFixed(2)+"MB]";if(t=t/1024,t<1024)return" ["+t.toFixed(2)+"GB]"}}});function V(){if(u!=null&&u.click){const t=Ne(n.value);u.click(t)}}function C(){_.value=!_.value}function N(t){const v=t.target;b.value=n.value.title+"_"+v.innerHTML,k.value=n.value.previewUrl+"/"+v.getAttribute("fileName"),z()}function z(){u!=null&&u.play&&u.play({name:b.value,url:P()+k.value})}return(t,v)=>{const d=ae;return c(),m("div",Ae,[i("div",De,[i("div",Te,[i("img",{onclick:V,src:f(P)()+f(n).coverUrl,onerror:"this.onerror=null;this.src='/favicon.png';",alt:"Sorry, something went wrong"},null,8,Pe),i("div",{class:"overlay",style:Ce({display:_.value?"flex":"none"})},[(c(!0),m(M,null,E(f(n).files,(F,x)=>(c(),U(d,{class:"item",effect:"dark",content:F.name,placement:"top",key:x},{default:r(()=>[i("div",{class:"overlay-item",onclick:N,fileName:F.value},I(F.name),9,Ge)]),_:2},1032,["content"]))),128))],4)]),i("div",We,[o(d,{class:"item",effect:"dark",content:f(n).title+f(y),placement:"bottom"},{default:r(()=>[i("h3",qe,I(f(n).title)+I(f(y)),1)]),_:1},8,["content"]),f(n).series=="是"?(c(),m("h3",{key:0,class:"movie-play",onclick:C}," 剧集 ")):(c(),m("h3",{key:1,class:"movie-play",onclick:z},"Play"))])])])}}}),He=A(Le,[["__scopeId","data-v-014efa5e"]]),q=p=>(Ue("data-v-5854b15f"),p=p(),$e(),p),Ke={class:"movie-gallery"},Oe={class:"flex-item"},Qe={class:"flex-item"},je=q(()=>i("span",{style:{"font-size":"small",color:"var(--gw-font-color)"}},"影片数量: ",-1)),Je={style:{"font-size":"small",color:"var(--gw-font-color)","font-style":"italic","font-weight":"bold","text-decoration":"underline"}},Xe={class:"flex-item",style:{"margin-left":"20px"}},Ye=q(()=>i("span",{width:"30px"},null,-1)),Ze={style:{width:"100%"}},el=W({__name:"Movie",setup(p){_e();const u=s(0),n=s(1),k=s(10),b=s(),_=s(!1),y=s(),V=s(),C=s(),N=s(),z=s(),t=s(),v=s(),d=s({name:"",folderName:"",url:""}),F=ze({name:[{required:!0,message:"请输入电影名称",trigger:"blur"}],folderName:[{required:!0,message:"请选择电影所属分类",trigger:"blur"}],url:[{required:!0,message:"请输入m3u8 url地址",trigger:"blur"}]}),x=s(!1),R=()=>{x.value=!1},L=()=>{x.value=!0},H=async a=>{a&&await a.validate(async(l,g)=>{l?(xe(d.value),R()):console.log("error submit!",g)})},K=a=>{y.value=a.title,V.value=a.previewUrl,C.value=a.id,D.value.click()},O=a=>{y.value=a.name,V.value=a.url,_.value=!0},Q=a=>{n.value=a,B()},B=async()=>{await he({pageNo:n.value,pageSize:k.value,folderName:t.value,name:v.value}).then(a=>{b.value=a.data.result,u.value=a.data.total})},D=s(),j=async a=>{if(C.value){const l=a.target;if(l.files&&l.files[0]){const g=new FileReader;g.onload=h=>{var S;(S=h.target)==null||S.result},g.readAsDataURL(l.files[0]);let w=new FormData;w.append("file",l.files[0]),w.append("id",C.value+""),await ye(w).then(h=>{h.data&&oe({type:"info",message:"电影海报已更新，请刷新页面查看"})}).finally(()=>{})}}},J=()=>{_.value=!1};Fe(()=>[t.value,v.value],()=>{B()},{deep:!0,immediate:!0});const X=()=>{we()};return Se(async()=>{B(),await ge({type:1}).then(a=>{N.value=a.data})}),(a,l)=>{const g=ie,w=re,h=ue,S=fe,Y=ve,Z=pe,ee=ne,$=ce,T=de,le=me,te=se;return c(),m(M,null,[i("div",Ke,[o(Y,null,{"left-items":r(()=>[i("div",Oe,[o(w,{modelValue:t.value,"onUpdate:modelValue":l[0]||(l[0]=e=>t.value=e),clearable:"",placeholder:"分类",style:{width:"150px"}},{default:r(()=>[(c(!0),m(M,null,E(N.value,e=>(c(),U(g,{key:e.value,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(h,{style:{"margin-left":"10px"},modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=e=>v.value=e),placeholder:"电影名称"},null,8,["modelValue"])])]),"right-items":r(()=>[i("div",Qe,[je,i("span",Je,I(u.value),1),i("div",Xe,[o(S,{size:20,"icon-class":"m3u8",class:"svg-icon",onclick:L}),Ye,o(S,{size:20,"icon-class":"refresh",class:"svg-icon",onclick:X})])])]),_:1}),o(Be,{style:{"min-height":"calc(100% - 100px)"}},{"flex-items":r(()=>[(c(!0),m(M,null,E(b.value,(e,ll)=>(c(),U(He,{click:K,play:O,movie:e},null,8,["movie"]))),256))]),_:1}),i("input",{ref_key:"fileselectRef",ref:D,style:{display:"none"},type:"file",accept:"image/*",onChange:j},null,544),_.value?(c(),U(Z,{key:0,url:V.value,name:y.value,"on-close":J},null,8,["url","name"])):Me("",!0),i("div",Ze,[o(ee,{style:{"flex-direction":"row-reverse"},background:"",layout:"prev, pager, next",total:u.value,"pager-count":5,"page-size":k.value,"current-page":n.value,onCurrentChange:Q},null,8,["total","page-size","current-page"])])]),o(te,{style:{padding:"30px","max-height":"500px",overflow:"scroll"},title:"m3u8解析",modelValue:x.value,"onUpdate:modelValue":l[6]||(l[6]=e=>x.value=e),width:"500px",onClose:R},{default:r(()=>[o(le,{ref_key:"m3u8FormRef",ref:z,model:d.value,"label-width":"auto",rules:F},{default:r(()=>[o($,{label:"电影名称：",prop:"name"},{default:r(()=>[o(h,{modelValue:d.value.name,"onUpdate:modelValue":l[2]||(l[2]=e=>d.value.name=e),placeholder:"请输入电影名称"},null,8,["modelValue"])]),_:1}),o($,{label:"所属分类：",prop:"folderName"},{default:r(()=>[o(w,{modelValue:d.value.folderName,"onUpdate:modelValue":l[3]||(l[3]=e=>d.value.folderName=e),filterable:"",placeholder:"请选择所属分类",style:{width:"200px"}},{default:r(()=>[(c(!0),m(M,null,E(N.value,e=>(c(),U(g,{key:e.value,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o($,{label:"解析地址：",prop:"url"},{default:r(()=>[o(h,{size:"small",type:"textarea",placeholder:"解析地址",modelValue:d.value.url,"onUpdate:modelValue":l[4]||(l[4]=e=>d.value.url=e),resize:"none",rows:4},null,8,["modelValue"])]),_:1}),o($,{style:{"flex-direction":"column"}},{default:r(()=>[o(T,{onClick:R},{default:r(()=>[G("取消")]),_:1}),o(T,{type:"primary",onClick:l[5]||(l[5]=e=>H(z.value))},{default:r(()=>[G("确定")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}}),xl=A(el,[["__scopeId","data-v-5854b15f"]]);export{xl as default};
