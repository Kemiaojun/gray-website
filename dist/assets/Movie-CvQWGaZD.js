import{E as ae,q as le,d as oe,c as ne,f as se,g as re,h as ie,i as ce,b as ue}from"./element-plus-COxNbMku.js";import{_ as me}from"./GWPreviewVideo-BjJyryAn.js";import{_ as de}from"./GWSearchCondition-BQD2lHP6.js";import{_ as E,b as B,f as pe}from"./index-ByjaIvS1.js";import{u as fe}from"./vue-router-DaOdIdNP.js";import{d as h}from"./request_website-DxfpAhny.js";import{c as f,D as _e,o as u,d as q,I as ve,a as r,u as I,U as G,ab as P,r as i,H as ge,w as he,b as ye,L as o,P as s,Q as F,V as we,M as D,a7 as R,T as W,at as xe,au as be}from"./@vue-BV9Q_yhH.js";import"./lodash-es-BDpUAi6D.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-DVUPgnhb.js";import"./dayjs-Didlxlvp.js";import"./@element-plus-DgtNr1CL.js";import"./@ctrl-D_sRHO8g.js";import"./@popperjs-D9SI2xQl.js";import"./pinia-CWZPuNdE.js";import"./axios-Cm0UX6qg.js";import"./vue-pdf-embed-BcRweBTn.js";const Ve=n=>{const t={headers:{"Content-Type":"multipart/form-data"}};return h.post("/movie/cover",n,t)},ke=()=>h.get("/movie/refresh"),Ce=()=>h.get("/movie/categories"),Fe=n=>h.post("/movie/page",{...n}),De=n=>h.post("/movie/m3u8",{...n}),Ie={},Ne={class:"gw-flex-container"};function Se(n,t){return u(),f("div",Ne,[_e(n.$slots,"flex-items",{},void 0,!0)])}const Re=E(Ie,[["render",Se],["__scopeId","data-v-4688a806"]]),Ee={class:"gw-flex-item"},Ue={class:"gw-flex-card"},$e=["src"],ze={class:"gw-flex-info"},Me={class:"movie-title"},Ae=q({__name:"GWFlexImage",props:{title:{},src:{},itemData:{},play:{type:Function},click:{type:Function}},setup(n){const t=n,{src:_,title:y}=ve(t);function w(){if(t!=null&&t.click){const c=t.itemData?P(t.itemData):{};t.click(c)}}function v(){if(t!=null&&t.play){const c=t.itemData?P(t.itemData):{};t.play(c)}}return(c,x)=>(u(),f("div",Ee,[r("div",Ue,[r("img",{onclick:w,src:I(_),onerror:"this.onerror=null;this.src='/favicon.png';",alt:"Sorry, something went wrong"},null,8,$e),r("div",ze,[r("h3",Me,G(I(y)),1),r("h3",{class:"movie-play",onclick:v},"Play")])])]))}}),Te=E(Ae,[["__scopeId","data-v-4f650451"]]),Be=n=>(xe("data-v-9ea98adb"),n=n(),be(),n),Pe={class:"image-gallery"},We={class:"flex-item"},qe={class:"flex-item"},Ge=Be(()=>r("span",{style:{"font-size":"small",color:"var(--gw-font-color)"}},"影片数量: ",-1)),Le={style:{"font-size":"small",color:"var(--gw-font-color)","font-style":"italic","font-weight":"bold","text-decoration":"underline"}},He={class:"flex-item",style:{"margin-left":"20px"}},Oe={style:{width:"100%"}},Qe=q({__name:"Movie",setup(n){fe();const t=i(0),_=i(1),y=i(20),w=i(),v=i(!1),c=i(),x=i(),U=i(),b=i(),m=i({name:"",folderName:"",url:""}),L=ge({name:[{required:!0,message:"请输入电影名称",trigger:"blur"}],folderName:[{required:!0,message:"请选择电影所属分类",trigger:"blur"}],url:[{required:!0,message:"请输入m3u8 url地址",trigger:"blur"}]}),V=i(!1),N=()=>{V.value=!1},H=()=>{V.value=!0},O=async l=>{l&&await l.validate(async(a,d)=>{a?(De(m.value),N()):console.log("error submit!",d)})},Q=l=>{c.value=l,$.value.click()},j=l=>{c.value=l,v.value=!0},J=l=>{_.value=l,S()},S=async()=>{await Fe({pageNo:_.value,pageSize:y.value,folderName:b.value}).then(l=>{w.value=l.data.result,t.value=l.data.total})},$=i(),K=async l=>{if(c.value){const a=l.target;if(a.files&&a.files[0]){const d=new FileReader;d.onload=g=>{var k;(k=g.target)==null||k.result},d.readAsDataURL(a.files[0]);let p=new FormData;p.append("file",a.files[0]),p.append("id",c.value.id+""),await Ve(p).then(g=>{debugger;g.data&&ae({type:"info",message:"电影海报已更新，请刷新页面查看"})}).finally(()=>{})}}},X=()=>{v.value=!1};return he(()=>b.value,()=>{S()},{deep:!0,immediate:!0}),ye(async()=>{S(),await Ce().then(l=>{x.value=l.data}),ke()}),(l,a)=>{var A,T;const d=ue,p=ne,g=pe,k=de,Y=me,Z=le,z=se,C=re,M=ie,ee=ce,te=oe;return u(),f(D,null,[r("div",Pe,[o(k,null,{"left-items":s(()=>[r("div",We,[o(p,{modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=e=>b.value=e),clearable:"",placeholder:"分类",style:{width:"150px"}},{default:s(()=>[(u(!0),f(D,null,R(x.value,e=>(u(),F(d,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),"right-items":s(()=>[r("div",qe,[Ge,r("span",Le,G(t.value),1),r("div",He,[o(g,{size:20,"icon-class":"m3u8",onclick:H})])])]),_:1}),o(Re,{style:{"min-height":"calc(100% - 100px)"}},{"flex-items":s(()=>[(u(!0),f(D,null,R(w.value,(e,je)=>(u(),F(Te,{click:Q,play:j,title:e.title,"item-data":e,src:I(B)()+e.coverUrl},null,8,["title","item-data","src"]))),256))]),_:1}),r("input",{ref_key:"fileselectRef",ref:$,style:{display:"none"},type:"file",accept:"image/*",onChange:K},null,544),v.value?(u(),F(Y,{key:0,url:I(B)()+((A=c.value)==null?void 0:A.previewUrl),name:(T=c.value)==null?void 0:T.title,"on-close":X},null,8,["url","name"])):we("",!0),r("div",Oe,[o(Z,{style:{"flex-direction":"row-reverse"},background:"",layout:"prev, pager, next",total:t.value,"pager-count":5,"page-size":y.value,"current-page":_.value,onCurrentChange:J},null,8,["total","page-size","current-page"])])]),o(te,{style:{padding:"30px","max-height":"500px",overflow:"scroll"},title:"m3u8解析",modelValue:V.value,"onUpdate:modelValue":a[5]||(a[5]=e=>V.value=e),width:"500px",onClose:N},{default:s(()=>[o(ee,{ref_key:"m3u8FormRef",ref:U,model:m.value,"label-width":"auto",rules:L},{default:s(()=>[o(C,{label:"电影名称：",prop:"name"},{default:s(()=>[o(z,{modelValue:m.value.name,"onUpdate:modelValue":a[1]||(a[1]=e=>m.value.name=e),placeholder:"请输入电影名称"},null,8,["modelValue"])]),_:1}),o(C,{label:"所属分类：",prop:"folderName"},{default:s(()=>[o(p,{modelValue:m.value.folderName,"onUpdate:modelValue":a[2]||(a[2]=e=>m.value.folderName=e),filterable:"",placeholder:"请选择所属分类",style:{width:"200px"}},{default:s(()=>[(u(!0),f(D,null,R(x.value,e=>(u(),F(d,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(C,{label:"解析地址：",prop:"url"},{default:s(()=>[o(z,{size:"small",type:"textarea",placeholder:"解析地址",modelValue:m.value.url,"onUpdate:modelValue":a[3]||(a[3]=e=>m.value.url=e),resize:"none",rows:4},null,8,["modelValue"])]),_:1}),o(C,{style:{"flex-direction":"column"}},{default:s(()=>[o(M,{onClick:N},{default:s(()=>[W("取消")]),_:1}),o(M,{type:"primary",onClick:a[4]||(a[4]=e=>O(U.value))},{default:s(()=>[W("确定")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}}),dt=E(Qe,[["__scopeId","data-v-9ea98adb"]]);export{dt as default};
