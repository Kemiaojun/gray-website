import{k as ae,E as ne,q as se,d as re,c as ie,f as ue,g as ce,h as de,i as me,b as pe}from"./element-plus-COxNbMku.js";import{_ as ve}from"./GWPreviewVideo-pVWLJOAT.js";import{_ as fe}from"./GWSearchCondition-DTa9RRwc.js";import{_ as A,b as G,f as _e}from"./index-BPLJeEng.js";import{u as ge}from"./vue-router-DaOdIdNP.js";import{d as $}from"./request_website-COP_Bfoo.js";import{c as p,D as he,o as d,d as q,I as ye,r as n,h as xe,a as i,u as x,S as we,M,a7 as I,Q as U,P as c,U as R,ab as ke,H as Ve,w as be,b as Ce,L as a,V as Ne,T as W,at as ze,au as Fe}from"./@vue-BV9Q_yhH.js";import"./lodash-es-BDpUAi6D.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-DVUPgnhb.js";import"./dayjs-Didlxlvp.js";import"./@element-plus-DgtNr1CL.js";import"./@ctrl-D_sRHO8g.js";import"./@popperjs-D9SI2xQl.js";import"./pinia-CWZPuNdE.js";import"./axios-Cm0UX6qg.js";import"./vue-pdf-embed-BcRweBTn.js";const Se=u=>{const r={headers:{"Content-Type":"multipart/form-data"}};return $.post("/movie/cover",u,r)},Me=()=>$.get("/movie/refresh"),Ue=()=>$.get("/movie/categories"),$e=u=>$.post("/movie/page",{...u}),Ee=u=>$.post("/movie/m3u8",{...u}),Ie={},Re={class:"gw-flex-container"};function Be(u,r){return d(),p("div",Re,[he(u.$slots,"flex-items",{},void 0,!0)])}const Te=A(Ie,[["render",Be],["__scopeId","data-v-4688a806"]]),Ae={class:"gw-flex-item"},De={class:"gw-flex-card"},Pe={class:"img-card"},Ge=["src"],We=["fileName"],qe={class:"gw-flex-info"},Le={class:"movie-title"},He=q({__name:"GWFlexMovieCard",props:{movie:{},play:{type:Function},click:{type:Function}},setup(u){const r=u,{movie:s}=ye(r),w=n(s.value.previewUrl),k=n(s.value.title),f=n(!1);let V=xe(()=>{if(s.value.size){if(s.value.series=="是")return" [共"+s.value.size+"集]";{let t=s.value.size/1024;if(t<1024)return" ["+t.toFixed(2)+"KB]";if(t=t/1024,t<1024)return" ["+t.toFixed(2)+"MB]";if(t=t/1024,t<1024)return" ["+t.toFixed(2)+"GB]"}}});function b(){if(r!=null&&r.click){const t=ke(s.value);r.click(t)}}function C(){f.value=!f.value}function N(t){const v=t.target;k.value=s.value.title+"_"+v.innerHTML,w.value=s.value.previewUrl+"/"+v.getAttribute("fileName"),z()}function z(){r!=null&&r.play&&r.play({name:k.value,url:G()+w.value})}return(t,v)=>{const m=ae;return d(),p("div",Ae,[i("div",De,[i("div",Pe,[i("img",{onclick:b,src:x(G)()+x(s).coverUrl,onerror:"this.onerror=null;this.src='/favicon.png';",alt:"Sorry, something went wrong"},null,8,Ge),i("div",{class:"overlay",style:we({display:f.value?"flex":"none"})},[(d(!0),p(M,null,I(x(s).files,(F,h)=>(d(),U(m,{class:"item",effect:"dark",content:F.name,placement:"top",key:h},{default:c(()=>[i("div",{class:"overlay-item",onclick:N,fileName:F.value},R(F.name),9,We)]),_:2},1032,["content"]))),128))],4)]),i("div",qe,[i("h3",Le,R(x(s).title)+R(x(V)),1),x(s).series=="是"?(d(),p("h3",{key:0,class:"movie-play",onclick:C}," 剧集 ")):(d(),p("h3",{key:1,class:"movie-play",onclick:z},"Play"))])])])}}}),Ke=A(He,[["__scopeId","data-v-0863f07e"]]),L=u=>(ze("data-v-24b09172"),u=u(),Fe(),u),Oe={class:"movie-gallery"},Qe={class:"flex-item"},je={class:"flex-item"},Je=L(()=>i("span",{style:{"font-size":"small",color:"var(--gw-font-color)"}},"影片数量: ",-1)),Xe={style:{"font-size":"small",color:"var(--gw-font-color)","font-style":"italic","font-weight":"bold","text-decoration":"underline"}},Ye={class:"flex-item",style:{"margin-left":"20px"}},Ze=L(()=>i("span",{width:"30px"},null,-1)),el={style:{width:"100%"}},ll=q({__name:"Movie",setup(u){ge();const r=n(0),s=n(1),w=n(10),k=n(),f=n(!1),V=n(),b=n(),C=n(),N=n(),z=n(),t=n(),v=n(),m=n({name:"",folderName:"",url:""}),F=Ve({name:[{required:!0,message:"请输入电影名称",trigger:"blur"}],folderName:[{required:!0,message:"请选择电影所属分类",trigger:"blur"}],url:[{required:!0,message:"请输入m3u8 url地址",trigger:"blur"}]}),h=n(!1),B=()=>{h.value=!1},H=()=>{h.value=!0},K=async o=>{o&&await o.validate(async(l,_)=>{l?(Ee(m.value),B()):console.log("error submit!",_)})},O=o=>{V.value=o.title,b.value=o.previewUrl,C.value=o.id,D.value.click()},Q=o=>{V.value=o.name,b.value=o.url,f.value=!0},j=o=>{s.value=o,T()},T=async()=>{await $e({pageNo:s.value,pageSize:w.value,folderName:t.value,name:v.value}).then(o=>{k.value=o.data.result,r.value=o.data.total})},D=n(),J=async o=>{if(C.value){const l=o.target;if(l.files&&l.files[0]){const _=new FileReader;_.onload=g=>{var S;(S=g.target)==null||S.result},_.readAsDataURL(l.files[0]);let y=new FormData;y.append("file",l.files[0]),y.append("id",C.value+""),await Se(y).then(g=>{g.data&&ne({type:"info",message:"电影海报已更新，请刷新页面查看"})}).finally(()=>{})}}},X=()=>{f.value=!1};be(()=>[t.value,v.value],()=>{T()},{deep:!0,immediate:!0});const Y=()=>{Me()};return Ce(async()=>{T(),await Ue().then(o=>{N.value=o.data})}),(o,l)=>{const _=pe,y=ie,g=ue,S=_e,Z=fe,ee=ve,le=se,E=ce,P=de,te=me,oe=re;return d(),p(M,null,[i("div",Oe,[a(Z,null,{"left-items":c(()=>[i("div",Qe,[a(y,{modelValue:t.value,"onUpdate:modelValue":l[0]||(l[0]=e=>t.value=e),clearable:"",placeholder:"分类",style:{width:"150px"}},{default:c(()=>[(d(!0),p(M,null,I(N.value,e=>(d(),U(_,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(g,{style:{"margin-left":"10px"},modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=e=>v.value=e),placeholder:"电影名称"},null,8,["modelValue"])])]),"right-items":c(()=>[i("div",je,[Je,i("span",Xe,R(r.value),1),i("div",Ye,[a(S,{size:20,"icon-class":"m3u8",class:"svg-icon",onclick:H}),Ze,a(S,{size:20,"icon-class":"refresh",class:"svg-icon",onclick:Y})])])]),_:1}),a(Te,{style:{"min-height":"calc(100% - 100px)"}},{"flex-items":c(()=>[(d(!0),p(M,null,I(k.value,(e,tl)=>(d(),U(Ke,{click:O,play:Q,movie:e},null,8,["movie"]))),256))]),_:1}),i("input",{ref_key:"fileselectRef",ref:D,style:{display:"none"},type:"file",accept:"image/*",onChange:J},null,544),f.value?(d(),U(ee,{key:0,url:b.value,name:V.value,"on-close":X},null,8,["url","name"])):Ne("",!0),i("div",el,[a(le,{style:{"flex-direction":"row-reverse"},background:"",layout:"prev, pager, next",total:r.value,"pager-count":5,"page-size":w.value,"current-page":s.value,onCurrentChange:j},null,8,["total","page-size","current-page"])])]),a(oe,{style:{padding:"30px","max-height":"500px",overflow:"scroll"},title:"m3u8解析",modelValue:h.value,"onUpdate:modelValue":l[6]||(l[6]=e=>h.value=e),width:"500px",onClose:B},{default:c(()=>[a(te,{ref_key:"m3u8FormRef",ref:z,model:m.value,"label-width":"auto",rules:F},{default:c(()=>[a(E,{label:"电影名称：",prop:"name"},{default:c(()=>[a(g,{modelValue:m.value.name,"onUpdate:modelValue":l[2]||(l[2]=e=>m.value.name=e),placeholder:"请输入电影名称"},null,8,["modelValue"])]),_:1}),a(E,{label:"所属分类：",prop:"folderName"},{default:c(()=>[a(y,{modelValue:m.value.folderName,"onUpdate:modelValue":l[3]||(l[3]=e=>m.value.folderName=e),filterable:"",placeholder:"请选择所属分类",style:{width:"200px"}},{default:c(()=>[(d(!0),p(M,null,I(N.value,e=>(d(),U(_,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(E,{label:"解析地址：",prop:"url"},{default:c(()=>[a(g,{size:"small",type:"textarea",placeholder:"解析地址",modelValue:m.value.url,"onUpdate:modelValue":l[4]||(l[4]=e=>m.value.url=e),resize:"none",rows:4},null,8,["modelValue"])]),_:1}),a(E,{style:{"flex-direction":"column"}},{default:c(()=>[a(P,{onClick:B},{default:c(()=>[W("取消")]),_:1}),a(P,{type:"primary",onClick:l[5]||(l[5]=e=>K(z.value))},{default:c(()=>[W("确定")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}}),xl=A(ll,[["__scopeId","data-v-24b09172"]]);export{xl as default};
