import{b as ne,E as se,q as ie,f as re,d as ce,e as ue,h as de,i as me,j as pe,k as ve}from"./element-plus-D_LIGSL8.js";/* empty css                                                                          */import{_ as B,g as G,a as fe}from"./index-CizMaJaH.js";import{o as u,c as p,a as i,D as A,d as L,I as _e,r as s,h as W,u as f,S as ge,M,a7 as E,Q as U,P as c,U as R,L as n,ab as he,H as ye,w as we,b as xe,V as be,ah as ke,T as q,at as Ve,au as Ce}from"./@vue-BV9Q_yhH.js";import{u as Ne}from"./vue-router-DaOdIdNP.js";import{m as $e,p as ze,a as Fe,b as Se,c as Me}from"./movie-sNvNRxMX.js";import"./lodash-es-BDpUAi6D.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-DVUPgnhb.js";import"./dayjs-Dc0JWrkO.js";import"./@element-plus-DgtNr1CL.js";import"./@ctrl-D_sRHO8g.js";import"./@popperjs-D9SI2xQl.js";/* empty css                             */import"./pinia-CWZPuNdE.js";import"./axios-Cm0UX6qg.js";import"./vue-pdf-embed-BcRweBTn.js";import"./request_website-CRo8-WmJ.js";const Ue={},Ie={class:"gw-search-root"},Ee={class:"left-items"},Re={class:"right-items"};function Be(m,r){return u(),p("div",Ie,[i("div",Ee,[A(m.$slots,"left-items",{},void 0,!0)]),i("div",Re,[A(m.$slots,"right-items",{},void 0,!0)])])}const De=B(Ue,[["render",Be],["__scopeId","data-v-0ba9ef38"]]),Ae={},Pe={class:"gw-flex-container"};function Te(m,r){return u(),p("div",Pe,[A(m.$slots,"flex-items",{},void 0,!0)])}const Ge=B(Ae,[["render",Te],["__scopeId","data-v-55ab031e"]]),We={class:"gw-flex-item"},qe={class:"gw-flex-card"},Le={class:"img-card"},je=["src"],He=["fileName"],Ke={class:"gw-flex-info"},Oe={class:"movie-title"},Qe=L({__name:"GWFlexMovieCard",props:{movie:{},play:{type:Function},click:{type:Function}},setup(m){const r=m,{movie:a}=_e(r),k=s(a.value.previewUrl),V=s(a.value.title),_=s(!1);let y=W(()=>{if(a.value.size){if(a.value.series=="是")return" [共"+a.value.size+"集]";{let e=a.value.size/1024;if(e<1024)return" ["+e.toFixed(2)+"KB]";if(e=e/1024,e<1024)return" ["+e.toFixed(2)+"MB]";if(e=e/1024,e<1024)return" ["+e.toFixed(2)+"GB]"}}});function C(){if(r!=null&&r.click){const e=he(a.value);r.click(e)}}function N(){_.value=!_.value}function $(e){const d=e.target;V.value=a.value.title+"_"+d.innerHTML,k.value=a.value.previewUrl+"/"+d.getAttribute("fileName"),z()}function z(){r!=null&&r.play&&r.play({name:V.value,url:G()+k.value})}let w=W(()=>{if(a.value.files)return a.value.files.map(e=>{const[d,x]=e.name.split("-");return{...e,chapter:d,title:x}})});return(e,d)=>{const x=ne;return u(),p("div",We,[i("div",qe,[i("div",Le,[i("img",{onclick:C,src:f(G)()+f(a).coverUrl,onerror:"this.onerror=null;this.src='/favicon.png';",alt:"Sorry, something went wrong"},null,8,je),i("div",{class:"overlay",style:ge({display:_.value?"flex":"none"})},[(u(!0),p(M,null,E(f(w),(v,F)=>(u(),U(x,{class:"item",effect:"dark",content:v.title,placement:"top",key:F},{default:c(()=>[i("div",{class:"overlay-item",onclick:$,fileName:v.value},R(v.chapter),9,He)]),_:2},1032,["content"]))),128))],4)]),i("div",Ke,[n(x,{class:"item",effect:"dark",content:f(a).title+f(y),placement:"bottom"},{default:c(()=>[i("h3",Oe,R(f(a).title)+R(f(y)),1)]),_:1},8,["content"]),f(a).series=="是"?(u(),p("h3",{key:0,class:"movie-play",onclick:N}," 剧集 ")):(u(),p("h3",{key:1,class:"movie-play",onclick:z},"Play"))])])])}}}),Je=B(Qe,[["__scopeId","data-v-1d9cb8e4"]]),j=m=>(Ve("data-v-69cd7886"),m=m(),Ce(),m),Xe={class:"movie-root-container"},Ye={class:"flex-item"},Ze={class:"flex-item"},et=j(()=>i("span",{style:{"font-size":"small",color:"var(--gw-bg-font)"}},"影片数量: ",-1)),tt={style:{"font-size":"small",color:"var(--gw-bg-font)","font-style":"italic","font-weight":"bold","text-decoration":"underline"}},lt={class:"flex-item",style:{"margin-left":"20px"}},at=j(()=>i("span",{width:"30px"},null,-1)),ot={style:{width:"100%","margin-top":"1rem"}},nt=L({__name:"Movie",setup(m){Ne();const r=s(0),a=s(1),k=s(10),V=s(),_=s(!1),y=s(),C=s(),N=s(),$=s(),z=s(),w=s(),e=s(),d=s({name:"",folderName:"",url:""}),x=ye({name:[{required:!0,message:"请输入电影名称",trigger:"blur"}],folderName:[{required:!0,message:"请选择电影所属分类",trigger:"blur"}],url:[{required:!0,message:"请输入m3u8 url地址",trigger:"blur"}]}),v=s(!1),F=()=>{v.value=!1},H=()=>{v.value=!0},K=async o=>{o&&await o.validate(async(l,g)=>{l?(Se(d.value),F()):console.log("error submit!",g)})},O=o=>{y.value=o.title,C.value=o.previewUrl,N.value=o.id,P.value.click()},Q=o=>{y.value=o.name,C.value=o.url,_.value=!0},J=o=>{a.value=o,D()},D=async()=>{await ze({pageNo:a.value,pageSize:k.value,folderName:w.value,name:e.value}).then(o=>{V.value=o.data.result,r.value=o.data.total})},P=s(),X=async o=>{if(N.value){const l=o.target;if(l.files&&l.files[0]){const g=new FileReader;g.onload=h=>{var S;(S=h.target)==null||S.result},g.readAsDataURL(l.files[0]);let b=new FormData;b.append("file",l.files[0]),b.append("id",N.value+""),await Fe(b).then(h=>{h.data&&se({type:"info",message:"电影海报已更新，请刷新页面查看"})}).finally(()=>{})}}},Y=()=>{_.value=!1};we(()=>[w.value,e.value],()=>{D()},{deep:!0,immediate:!0});const Z=()=>{Me()};return xe(async()=>{D(),await $e({type:1}).then(o=>{$.value=o.data})}),(o,l)=>{const g=ce,b=ue,h=de,S=fe,ee=De,te=ke("GWPreviewVideo"),le=ie,I=me,T=pe,ae=ve,oe=re;return u(),p(M,null,[i("div",Xe,[n(ee,null,{"left-items":c(()=>[i("div",Ye,[n(b,{modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=t=>w.value=t),clearable:"",placeholder:"分类",style:{width:"150px"}},{default:c(()=>[(u(!0),p(M,null,E($.value,t=>(u(),U(g,{key:t.value,label:t.name,value:t.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n(h,{style:{"margin-left":"10px"},modelValue:e.value,"onUpdate:modelValue":l[1]||(l[1]=t=>e.value=t),placeholder:"电影名称"},null,8,["modelValue"])])]),"right-items":c(()=>[i("div",Ze,[et,i("span",tt,R(r.value),1),i("div",lt,[n(S,{size:20,"icon-class":"m3u8",class:"svg-icon",onclick:H}),at,n(S,{size:20,"icon-class":"refresh",class:"svg-icon",onclick:Z})])])]),_:1}),n(Ge,{style:{"min-height":"calc(100% - 100px)","justify-content":"space-around"}},{"flex-items":c(()=>[(u(!0),p(M,null,E(V.value,(t,st)=>(u(),U(Je,{click:O,play:Q,movie:t},null,8,["movie"]))),256))]),_:1}),i("input",{ref_key:"fileselectRef",ref:P,style:{display:"none"},type:"file",accept:"image/*",onChange:X},null,544),_.value?(u(),U(te,{key:0,url:C.value,name:y.value,"on-close":Y},null,8,["url","name"])):be("",!0),i("div",ot,[n(le,{style:{"flex-direction":"row-reverse"},background:"",layout:"prev, pager, next",total:r.value,"pager-count":5,"page-size":k.value,"current-page":a.value,onCurrentChange:J},null,8,["total","page-size","current-page"])])]),n(oe,{style:{padding:"30px","max-height":"500px",overflow:"scroll"},title:"m3u8解析",modelValue:v.value,"onUpdate:modelValue":l[6]||(l[6]=t=>v.value=t),width:"500px",onClose:F},{default:c(()=>[n(ae,{ref_key:"m3u8FormRef",ref:z,model:d.value,"label-width":"auto",rules:x},{default:c(()=>[n(I,{label:"电影名称：",prop:"name"},{default:c(()=>[n(h,{modelValue:d.value.name,"onUpdate:modelValue":l[2]||(l[2]=t=>d.value.name=t),placeholder:"请输入电影名称"},null,8,["modelValue"])]),_:1}),n(I,{label:"所属分类：",prop:"folderName"},{default:c(()=>[n(b,{modelValue:d.value.folderName,"onUpdate:modelValue":l[3]||(l[3]=t=>d.value.folderName=t),filterable:"",placeholder:"请选择所属分类",style:{width:"200px"}},{default:c(()=>[(u(!0),p(M,null,E($.value,t=>(u(),U(g,{key:t.value,label:t.name,value:t.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(I,{label:"解析地址：",prop:"url"},{default:c(()=>[n(h,{size:"small",type:"textarea",placeholder:"解析地址",modelValue:d.value.url,"onUpdate:modelValue":l[4]||(l[4]=t=>d.value.url=t),resize:"none",rows:4},null,8,["modelValue"])]),_:1}),n(I,{style:{"flex-direction":"column"}},{default:c(()=>[n(T,{onClick:F},{default:c(()=>[q("取消")]),_:1}),n(T,{type:"primary",onClick:l[5]||(l[5]=t=>K(z.value))},{default:c(()=>[q("确定")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}}),Ct=B(nt,[["__scopeId","data-v-69cd7886"]]);export{Ct as default};
